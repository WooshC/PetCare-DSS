events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    
    # Aumentar timeouts por si acaso
    proxy_connect_timeout 600;
    proxy_send_timeout 600;
    proxy_read_timeout 600;
    send_timeout 600;

    server {
        listen 80;

        # Frontend - Raíz
        location / {
            proxy_pass http://petcare-frontend:80;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Auth Service
        # Usamos proxy_pass SIN path para preservar la URI original tal cual
        location /api/Auth {
            proxy_pass http://petcare-auth:8080;
            proxy_set_header Host $host;
        }

        # Cliente Service
        location /api/cliente {
            proxy_pass http://petcare-cliente:8080;
            proxy_set_header Host $host;
        }

        # Cuidador Service
        location /api/cuidador {
            proxy_pass http://petcare-cuidador:8080;
            proxy_set_header Host $host;
        }

        # Payment Service
        location /api/Payment {
            proxy_pass http://petcare-payment:8080;
            proxy_set_header Host $host;
        }

        # Calificar Service
        location /api/ratings {
            proxy_pass http://petcare-calificar:8080;
            proxy_set_header Host $host;
        }

        # Request Service - Rutas Específicas
        # Captura /api/Solicitud... (Incluye SolicitudCliente, SolicitudCuidador, etc.)
        location /api/Solicitud {
            proxy_pass http://petcare-request:8080;
            proxy_set_header Host $host;
        }
        
        # Fallback para otras rutas de Request Service si existieran y no empezaran por Solicitud
        # (Pero tratamos de ser específicos para evitar colisiones 404)
    }
}
